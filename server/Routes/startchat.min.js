const express=require("express"),db=require("../database/model"),{authenticate:authenticate}=require("./auth"),{CheckOne_One:CheckOne_One}=require("../database/queries"),startchatRouter=express.Router();startchatRouter.post("/user",authenticate,(async(req,res)=>{const{id:id}=req.body;try{const foundPrivateChat=db.prepare("SELECT id FROM one_one WHERE (receiver_id = ? AND sender_id = ?) or (receiver_id = ? AND sender_id = ?)").get(id,req.user.id,req.user.id,id);if(foundPrivateChat)res.json({id:foundPrivateChat.id});else{const createPrivateChat=db.prepare("INSERT INTO one_one (receiver_id, sender_id) VALUES (?, ?) RETURNING id").get(id,req.user.id);res.json({id:createPrivateChat.id})}}catch(err){return console.error("Private chat connection error:",err),res.status(400).json({message:"Private chat was no made"})}})),startchatRouter.post("/checkuser",authenticate,(async(req,res)=>{const{id:id}=req.body;await CheckOne_One({userid:req.user.id,id:id},(chat=>chat?void res.json({status:"proceed"}):void res.json({status:"return"})))})),module.exports={startchatRouter:startchatRouter};